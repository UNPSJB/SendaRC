{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>
        {% if servicio.estado == 1 or servicio.estado == 2 %}
            Presupuesto N° {{ servicio.pk }}
        {% else %}
            Contrato N° {{ servicio.pk }}
        {% endif %}
    </title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 11px;
            line-height: 1.4;
            color: #1a202c;
            background: #f7fafc;
            margin: 0;
            padding: 20px;
        }

        .document-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            border-radius: 12px;
            overflow: hidden;
        }

        /* Header con gradiente moderno */
        .document-header {
            position: relative;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            {% elif servicio.estado == 5 %}
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            {% elif servicio.estado == 6 %}
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            {% else %}
                background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            {% endif %}
            color: white;
            padding: 40px 30px;
            position: relative;
            overflow: hidden;
        }

        .document-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(50%, -50%);
        }

        .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .document-title {
            flex: 1;
        }

        .document-title h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .document-number {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .status-pill {
            display: inline-block;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .company-logo {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .company-logo img {
            display: block;
        }

        /* Información de la empresa */
        .company-details {
            background: linear-gradient(to right, #f8fafc, #edf2f7);
            padding: 25px 30px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .company-name {
            font-size: 20px;
            font-weight: 800;
            color: #2d3748;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .company-info {
            font-size: 10px;
            color: #718096;
            line-height: 1.6;
        }

        .company-info strong {
            color: #4a5568;
        }

        /* Contenido principal */
        .main-content {
            padding: 30px;
        }

        /* Información del cliente y servicio */
        .info-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f7fafc;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .card-header {
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                background: linear-gradient(135deg, #667eea, #764ba2);
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                background: linear-gradient(135deg, #11998e, #38ef7d);
            {% elif servicio.estado == 5 %}
                background: linear-gradient(135deg, #f093fb, #f5576c);
            {% elif servicio.estado == 6 %}
                background: linear-gradient(135deg, #4facfe, #00f2fe);
            {% else %}
                background: linear-gradient(135deg, #fa709a, #fee140);
            {% endif %}
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-body {
            padding: 20px;
            background: white;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 10px;
            color: #718096;
            font-weight: 500;
        }

        .info-value {
            font-size: 11px;
            color: #2d3748;
            font-weight: 600;
        }

        /* Tabla de servicios moderna */
        .services-section {
            margin: 30px 0;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .services-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .services-table thead {
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                background: linear-gradient(135deg, #667eea, #764ba2);
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                background: linear-gradient(135deg, #11998e, #38ef7d);
            {% elif servicio.estado == 5 %}
                background: linear-gradient(135deg, #f093fb, #f5576c);
            {% elif servicio.estado == 6 %}
                background: linear-gradient(135deg, #4facfe, #00f2fe);
            {% else %}
                background: linear-gradient(135deg, #fa709a, #fee140);
            {% endif %}
        }

        .services-table th {
            color: white;
            font-weight: 600;
            padding: 15px 12px;
            text-align: center;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .services-table td {
            padding: 12px;
            text-align: center;
            font-size: 11px;
            color: #4a5568;
            border-bottom: 1px solid #f1f5f9;
        }

        .services-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .services-table tr:hover {
            background: #edf2f7;
            transition: background 0.2s ease;
        }

        .service-description {
            text-align: left !important;
            font-weight: 500;
            color: #2d3748;
        }

        .service-total {
            font-weight: 700;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                color: #667eea;
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                color: #11998e;
            {% elif servicio.estado == 5 %}
                color: #f093fb;
            {% elif servicio.estado == 6 %}
                color: #4facfe;
            {% else %}
                color: #fa709a;
            {% endif %}
        }

        /* Frecuencias con diseño de tags */
        .frequencies-section {
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .frequency-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                border-left-color: #667eea;
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                border-left-color: #11998e;
            {% elif servicio.estado == 5 %}
                border-left-color: #f093fb;
            {% elif servicio.estado == 6 %}
                border-left-color: #4facfe;
            {% else %}
                border-left-color: #fa709a;
            {% endif %}
            font-size: 10px;
            font-weight: 600;
            color: #4a5568;
        }

        /* Empleados (solo para contratos) */
        .employees-section {
            margin: 30px 0;
        }

        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .employee-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .employee-name {
            font-size: 12px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .employee-detail {
            font-size: 10px;
            color: #718096;
            margin-bottom: 4px;
        }

        /* Desglose de cálculos mejorado */
        .calculations-section {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid #e2e8f0;
        }

        .calculations-title {
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                color: #667eea;
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                color: #11998e;
            {% elif servicio.estado == 5 %}
                color: #f093fb;
            {% elif servicio.estado == 6 %}
                color: #4facfe;
            {% else %}
                color: #fa709a;
            {% endif %}
        }

        .calculation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 11px;
        }

        .calculation-item:last-child {
            border-bottom: none;
            border-top: 2px solid;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                border-top-color: #667eea;
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                border-top-color: #11998e;
            {% elif servicio.estado == 5 %}
                border-top-color: #f093fb;
            {% elif servicio.estado == 6 %}
                border-top-color: #4facfe;
            {% else %}
                border-top-color: #fa709a;
            {% endif %}
            padding-top: 15px;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 700;
            {% if servicio.estado == 1 or servicio.estado == 2 %}
                color: #667eea;
            {% elif servicio.estado == 3 or servicio.estado == 4 %}
                color: #11998e;
            {% elif servicio.estado == 5 %}
                color: #f093fb;
            {% elif servicio.estado == 6 %}
                color: #4facfe;
            {% else %}
                color: #fa709a;
            {% endif %}
        }

        .calc-label {
            color: #4a5568;
            font-weight: 500;
        }

        .calc-value {
            font-weight: 700;
            color: #2d3748;
        }

        /* Footer elegante */
        .document-footer {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .footer-company {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .footer-message {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .footer-details {
            font-size: 10px;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .info-cards {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .frequency-grid,
            .employees-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print optimizations */
        @media print {
            body { 
                padding: 0; 
                font-size: 10px; 
                background: white;
            }
            .document-container { 
                border-radius: 0;
                box-shadow: none; 
            }
            .calculations-section,
            .employee-card {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<div class="document-container">
    <!-- Header Principal -->
    <div class="document-header">
        <div class="header-content">
            <div class="document-title">
                <h1>
                    {% if servicio.estado == 1 or servicio.estado == 2 %}
                        PRESUPUESTO
                    {% else %}
                        CONTRATO
                    {% endif %}
                </h1>
                <div class="document-number">N° {{ servicio.pk }}</div>
                <div class="status-pill">{{ servicio.getEstado }}</div>
            </div>
            <div class="company-logo">
                <img src="{{ img_url }}" width="120" alt="Logo SENDA">
            </div>
        </div>
    </div>

    <!-- Información de la Empresa -->
    <div class="company-details">
        <div class="company-name">SENDA SRL</div>
        <div class="company-info">
            <strong>Velero Mimosa 152 Esq. Pje. Santiago del Estero</strong> - Tel (280)420866 - Trelew, Chubut<br>
            <strong>Dante Brozzi 830</strong> - (280)451069 - Esquel<br>
            📧 senda@cpsarg.com | 🌐 www.sendaservicios.com.ar
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="main-content">
        
        <!-- Información del Cliente y Servicio -->
        <div class="info-cards">
            <div class="info-card">
                <div class="card-header">
                    👤 INFORMACIÓN DEL CLIENTE
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="info-label">Nombre Completo:</span>
                        <span class="info-value">{{ servicio.cliente.nombre }} {{ servicio.cliente.apellido }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">CUIL/CUIT:</span>
                        <span class="info-value">{{ servicio.cliente.cuil }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Teléfono:</span>
                        <span class="info-value">{{ servicio.cliente.telefono }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Email:</span>
                        <span class="info-value">{{ servicio.cliente.email }}</span>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    📋 DETALLES DEL SERVICIO
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="info-label">Fecha de Emisión:</span>
                        <span class="info-value">{{ servicio.fecha_emision|date:"d/m/Y" }}</span>
                    </div>
                    {% if servicio.estado == 1 or servicio.estado == 2 %}
                        <div class="info-row">
                            <span class="info-label">Vigencia Hasta:</span>
                            <span class="info-value">{{ servicio.plazo_vigencia|date:"d/m/Y" }}</span>
                        </div>
                    {% else %}
                        <div class="info-row">
                            <span class="info-label">Fecha de Inicio:</span>
                            <span class="info-value">{{ servicio.fecha_inicio|date:"d/m/Y" }}</span>
                        </div>
                        {% if servicio.tipo == 2 and servicio.fecha_finaliza %}
                            <div class="info-row">
                                <span class="info-label">Fecha de Fin:</span>
                                <span class="info-value">{{ servicio.fecha_finaliza|date:"d/m/Y" }}</span>
                            </div>
                        {% endif %}
                    {% endif %}
                    <div class="info-row">
                        <span class="info-label">Tipo de Contrato:</span>
                        <span class="info-value">{{ servicio.getTipo }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Empleados Requeridos:</span>
                        <span class="info-value">{{ servicio.cant_empleados }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de Servicios -->
        <div class="services-section">
            <h3 class="section-title">
                🛠️ SERVICIOS CONTRATADOS
            </h3>
            <table class="services-table">
                <thead>
                    <tr>
                        <th>DESCRIPCIÓN DEL SERVICIO</th>
                        <th>CANT.</th>
                        <th>U.M.</th>
                        <th>PRECIO UNITARIO</th>
                        <th>IMPORTE TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tipoServicio in tipoServicios %}
                    <tr>
                        <td class="service-description">{{ tipoServicio.tipoServicio.descripcion }}</td>
                        <td>{{ tipoServicio.cantidad }}</td>
                        <td>{{ tipoServicio.tipoServicio.getUnidadMedida }}</td>
                        <td>${{ tipoServicio.tipoServicio.getPrecioFormateado }}</td>
                        <td class="service-total">${{ tipoServicio.getPrecio }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Frecuencias de Servicio -->
        <div class="frequencies-section">
            <h3 class="section-title">📅 FRECUENCIAS DE SERVICIO</h3>
            <div class="frequency-grid">
                {% for frecuencia in frecuencias %}
                    <div class="frequency-card">
                        {{ frecuencia.getDia }} - {{ frecuencia.getTurno }}
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Empleados Asignados (solo para contratos) -->
        {% if servicio.estado != 1 and servicio.estado != 2 and servicio.empleado.exists %}
        <div class="employees-section">
            <h3 class="section-title">👷 EMPLEADOS ASIGNADOS</h3>
            <div class="employees-grid">
                {% for empleado in servicio.empleado.all %}
                <div class="employee-card">
                    <div class="employee-name">{{ empleado.nombre }} {{ empleado.apellido }}</div>
                    <div class="employee-detail"><strong>DNI:</strong> {{ empleado.numDNI }}</div>
                    <div class="employee-detail"><strong>Teléfono:</strong> {{ empleado.telefono }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Desglose de Cálculos -->
        <div class="calculations-section">
            <h3 class="calculations-title">💰 DESGLOSE DETALLADO DE CÁLCULOS</h3>
            
            <div class="calculation-item">
                <span class="calc-label">Subtotal de Servicios (por turno):</span>
                <span class="calc-value">${{ subtotal_formateado }}</span>
            </div>
            
            <div class="calculation-item">
                <span class="calc-label">Total Servicios ({{ frecuencias|length }} frecuencias):</span>
                <span class="calc-value">${{ total_servicios_formateado }}</span>
            </div>
            
            <div class="calculation-item">
                <span class="calc-label">Empleados Totales Calculados:</span>
                <span class="calc-value">{{ empleados_calculados }} empleados</span>
            </div>
            
            <div class="calculation-item">
                <span class="calc-label">Costo de Mano de Obra:</span>
                <span class="calc-value">${{ mano_obra_formateado }}</span>
            </div>
            
            <div class="calculation-item">
                <span class="calc-label">Ganancia Empresarial (15%):</span>
                <span class="calc-value">${{ ganancia_formateado }}</span>
            </div>
            
            {% if servicio.porcentaje != 0 %}
            <div class="calculation-item">
                <span class="calc-label">Ajuste Aplicado ({{ servicio.porcentaje }}%):</span>
                <span class="calc-value">${{ ajuste_formateado }}</span>
            </div>
            {% endif %}
            
            <div class="calculation-item">
                <span class="calc-label">
                    {% if servicio.tipo == 2 %}
                        💼 TOTAL MENSUAL FINAL:
                    {% else %}
                        💼 IMPORTE TOTAL FINAL:
                    {% endif %}
                </span>
                <span class="calc-value">{{ servicio.getImporteTotalFormateado }}</span>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="document-footer">
        <div class="footer-company">SENDA SRL</div>
        <div class="footer-message">Saludamos a ustedes muy atentamente</div>
        {% if servicio.estado == 1 or servicio.estado == 2 %}
            <div class="footer-details">Presupuesto válido hasta el {{ servicio.plazo_vigencia|date:"d/m/Y" }}</div>
        {% else %}
            <div class="footer-details">Contrato generado el {{ servicio.fecha_emision|date:"d/m/Y" }} - Estado: {{ servicio.getEstado }}</div>
        {% endif %}
    </div>
</div>

</body>
</html>